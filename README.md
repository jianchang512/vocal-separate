[English README](./README_EN.md) / [ğŸ‘‘æåŠ©è¯¥é¡¹ç›®](https://github.com/jianchang512/pyvideotrans/blob/main/about.md) / [Discord](https://discord.gg/TMCM2PfHzQ) 

# éŸ³ä¹äººå£°åˆ†ç¦»å·¥å…·

è¿™æ˜¯ä¸€ä¸ªæç®€çš„äººå£°å’ŒèƒŒæ™¯éŸ³ä¹åˆ†ç¦»å·¥å…·ï¼Œæœ¬åœ°åŒ–ç½‘é¡µæ“ä½œï¼Œæ— éœ€è¿æ¥å¤–ç½‘ï¼Œä½¿ç”¨ 2stems/4stems/5stems æ¨¡å‹ã€‚


å°†ä¸€é¦–æ­Œæ›²æˆ–è€…å«æœ‰èƒŒæ™¯éŸ³ä¹çš„éŸ³è§†é¢‘æ–‡ä»¶ï¼Œæ‹–æ‹½åˆ°æœ¬åœ°ç½‘é¡µä¸­ï¼Œå³å¯å°†å…¶ä¸­çš„äººå£°å’ŒéŸ³ä¹å£°åˆ†ç¦»ä¸ºå•ç‹¬çš„éŸ³é¢‘wavæ–‡ä»¶ï¼Œå¯é€‰å•ç‹¬åˆ†ç¦»â€œé’¢ç´å£°â€ã€â€œè´æ–¯å£°â€ã€â€œé¼“å£°â€ç­‰

è‡ªåŠ¨è°ƒç”¨æœ¬åœ°æµè§ˆå™¨æ‰“å¼€æœ¬åœ°ç½‘é¡µï¼Œæ¨¡å‹å·²å†…ç½®ï¼Œæ— éœ€è¿æ¥å¤–ç½‘ä¸‹è½½ã€‚

æ”¯æŒè§†é¢‘(mp4/mov/mkv/avi/mpeg)å’ŒéŸ³é¢‘(mp3/wav)æ ¼å¼

åªéœ€ç‚¹ä¸¤ä¸‹é¼ æ ‡ï¼Œä¸€é€‰æ‹©éŸ³è§†é¢‘æ–‡ä»¶ï¼ŒäºŒå¯åŠ¨å¤„ç†ã€‚


> **[èµåŠ©å•†]**
> 
> [![](https://github.com/user-attachments/assets/5348c86e-2d5f-44c7-bc1b-3cc5f077e710)](https://gpt302.saaslink.net/teRK8Y)
>  [302.AI](https://gpt302.saaslink.net/teRK8Y)æ˜¯ä¸€ä¸ªæŒ‰éœ€ä»˜è´¹çš„ä¸€ç«™å¼AIåº”ç”¨å¹³å°ï¼Œå¼€æ”¾å¹³å°ï¼Œå¼€æºç”Ÿæ€, [302.AIå¼€æºåœ°å€](https://github.com/302ai)
> 
> é›†åˆäº†æœ€æ–°æœ€å…¨çš„AIæ¨¡å‹å’Œå“ç‰Œ/æŒ‰éœ€ä»˜è´¹é›¶æœˆè´¹/ç®¡ç†å’Œä½¿ç”¨åˆ†ç¦»/æ‰€æœ‰AIèƒ½åŠ›å‡æä¾›API/æ¯å‘¨æ¨å‡º2-3ä¸ªæ–°åº”ç”¨


# è§†é¢‘æ¼”ç¤º

https://github.com/jianchang512/vocal-separate/assets/3378335/8e6b1b20-70d4-45e3-b106-268888fc0240



![image](./images/1.png)



# é¢„ç¼–è¯‘Winç‰ˆä½¿ç”¨æ–¹æ³•/Linuxå’ŒMacæºç éƒ¨ç½²

1. [ç‚¹å‡»æ­¤å¤„æ‰“å¼€Releasesé¡µé¢ä¸‹è½½](https://github.com/jianchang512/vocal-separate/releases)é¢„ç¼–è¯‘æ–‡ä»¶

2. ä¸‹è½½åè§£å‹åˆ°æŸå¤„ï¼Œæ¯”å¦‚ E:/vocal-separate

3. åŒå‡» start.exe ï¼Œç­‰å¾…è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨çª—å£å³å¯

4. ç‚¹å‡»é¡µé¢ä¸­çš„ä¸Šä¼ åŒºåŸŸï¼Œåœ¨å¼¹çª—ä¸­æ‰¾åˆ°æƒ³åˆ†ç¦»çš„éŸ³è§†é¢‘æ–‡ä»¶ï¼Œæˆ–ç›´æ¥æ‹–æ‹½éŸ³é¢‘æ–‡ä»¶åˆ°ä¸Šä¼ åŒºåŸŸï¼Œç„¶åç‚¹å‡»â€œç«‹å³åˆ†ç¦»â€ï¼Œç¨ç­‰ç‰‡åˆ»ï¼Œåº•éƒ¨ä¼šæ˜¾ç¤ºæ¯ä¸ªåˆ†ç¦»æ–‡ä»¶ä»¥åŠæ’­æ”¾æ§ä»¶ï¼Œç‚¹å‡»æ’­æ”¾ã€‚

5. å¦‚æœæœºå™¨æ‹¥æœ‰è‹±ä¼Ÿè¾¾GPUï¼Œå¹¶æ­£ç¡®é…ç½®äº†CUDAç¯å¢ƒï¼Œå°†è‡ªåŠ¨ä½¿ç”¨CUDAåŠ é€Ÿ


# æºç éƒ¨ç½²(Linux/Mac/Window)

0. è¦æ±‚ python 3.9->3.11

1. åˆ›å»ºç©ºç›®å½•ï¼Œæ¯”å¦‚ E:/vocal-separate, åœ¨è¿™ä¸ªç›®å½•ä¸‹æ‰“å¼€ cmd çª—å£ï¼Œæ–¹æ³•æ˜¯åœ°å€æ ä¸­è¾“å…¥ `cmd`, ç„¶åå›è½¦ã€‚

	ä½¿ç”¨gitæ‹‰å–æºç åˆ°å½“å‰ç›®å½• ` git clone git@github.com:jianchang512/vocal-separate.git . `

2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ `python -m venv venv`

3. æ¿€æ´»ç¯å¢ƒï¼Œwinä¸‹å‘½ä»¤ `%cd%/venv/scripts/activate`ï¼Œlinuxå’ŒMacä¸‹å‘½ä»¤ `source ./venv/bin/activate`

4. å®‰è£…ä¾èµ–: `pip install -r requirements.txt`

5. winä¸‹è§£å‹ ffmpeg.7zï¼Œå°†å…¶ä¸­çš„`ffmpeg.exe`å’Œ`ffprobe.exe`æ”¾åœ¨é¡¹ç›®ç›®å½•ä¸‹, linuxå’Œmac åˆ° [ffmpegå®˜ç½‘](https://ffmpeg.org/download.html)ä¸‹è½½å¯¹åº”ç‰ˆæœ¬ffmpegï¼Œè§£å‹å…¶ä¸­çš„`ffmpeg`å’Œ`ffprobe`äºŒè¿›åˆ¶ç¨‹åºæ”¾åˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹

6. [ä¸‹è½½æ¨¡å‹å‹ç¼©åŒ…](https://github.com/jianchang512/vocal-separate/releases/download/0.0/models-all.7z)ï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `pretrained_models` æ–‡ä»¶å¤¹ä¸­è§£å‹ï¼Œè§£å‹åï¼Œ`pretrained_models`ä¸­å°†æœ‰3ä¸ªæ–‡ä»¶å¤¹ï¼Œåˆ†åˆ«æ˜¯`2stems`/`3stems`/`5stems`

7. æ‰§è¡Œ  `python  start.py `ï¼Œç­‰å¾…è‡ªåŠ¨æ‰“å¼€æœ¬åœ°æµè§ˆå™¨çª—å£ã€‚


# API æ¥å£

æ¥å£åœ°å€: http://127.0.0.1:9999/api

è¯·æ±‚æ–¹æ³•: POST

è¯·æ±‚å‚æ•°:

    file: è¦åˆ†ç¦»çš„éŸ³è§†é¢‘æ–‡ä»¶

    model: æ¨¡å‹åç§° 2stems,4stems,5stems

è¿”å›å“åº”: json
    code:int, 0 å¤„ç†æˆåŠŸå®Œæˆï¼Œ>0 å‡ºé”™

    msg:str,  å‡ºé”™æ—¶å¡«å……é”™è¯¯ä¿¡æ¯

    data: List[str], æ¯ä¸ªåˆ†ç¦»åçš„wav urlåœ°å€ï¼Œä¾‹å¦‚ ['http://127.0.0.1:9999/static/files/2/accompaniment.wav']

    status_text: dict[str,str], æ¯ä¸ªåˆ†ç¦»åwavæ–‡ä»¶çš„åŒ…å«ä¿¡æ¯,{'accompaniment': 'ä¼´å¥', 'bass': 'ä½éŸ³', 'drums': 'é¼“', 'other': 'å…¶ä»–', 'piano': 'ç´', 'vocals': 'äººå£°'}

```
import requests
# è¯·æ±‚åœ°å€
url = "http://127.0.0.1:9999/api"
files = {"file": open("C:\\Users\\c1\\Videos\\2.wav", "rb")}
data={"model":"2stems"}
response = requests.request("POST", url, timeout=600, data=data,files=files)
print(response.json())

{'code': 0, 'data': ['http://127.0.0.1:9999/static/files/2/accompaniment.wav', 'http://127.0.0.1:9999/static/files/2/vocals.wav'], 'msg': 'åˆ†ç¦»æˆåŠŸ
', 'status_text': {'accompaniment': 'ä¼´å¥', 'bass': 'ä½éŸ³', 'drums': 'é¼“', 'other': 'å…¶ä»–', 'piano': 'ç´', 'vocals': 'äººå£°'}}


```



# CUDA åŠ é€Ÿæ”¯æŒ

**å®‰è£…CUDAå·¥å…·** [è¯¦ç»†å®‰è£…æ–¹æ³•](https://juejin.cn/post/7318704408727519270)

å¦‚æœä½ çš„ç”µè„‘æ‹¥æœ‰ Nvidia æ˜¾å¡ï¼Œå…ˆå‡çº§æ˜¾å¡é©±åŠ¨åˆ°æœ€æ–°ï¼Œç„¶åå»å®‰è£…å¯¹åº”çš„ 
   [CUDA Toolkit 11.8](https://developer.nvidia.com/cuda-downloads)  å’Œ  [cudnn for CUDA11.X](https://developer.nvidia.com/rdp/cudnn-archive)ã€‚
   
   å®‰è£…å®Œæˆæˆï¼ŒæŒ‰`Win + R`,è¾“å…¥ `cmd`ç„¶åå›è½¦ï¼Œåœ¨å¼¹å‡ºçš„çª—å£ä¸­è¾“å…¥`nvcc --version`,ç¡®è®¤æœ‰ç‰ˆæœ¬ä¿¡æ¯æ˜¾ç¤ºï¼Œç±»ä¼¼è¯¥å›¾
   ![image](https://github.com/jianchang512/pyvideotrans/assets/3378335/e68de07f-4bb1-4fc9-bccd-8f841825915a)

   ç„¶åç»§ç»­è¾“å…¥`nvidia-smi`,ç¡®è®¤æœ‰è¾“å‡ºä¿¡æ¯ï¼Œå¹¶ä¸”èƒ½çœ‹åˆ°cudaç‰ˆæœ¬å·ï¼Œç±»ä¼¼è¯¥å›¾
   ![image](https://github.com/jianchang512/pyvideotrans/assets/3378335/71f1d7d3-07f9-4579-b310-39284734006b)



# æ³¨æ„äº‹é¡¹

0. ä¸­æ–‡éŸ³ä¹æˆ–ä¸­å¼ä¹å™¨ï¼Œå»ºè®®é€‰æ‹©ä½¿ç”¨`2stems`æ¨¡å‹ï¼Œå…¶ä»–æ¨¡å‹å¯¹â€œé’¢ç´ã€è´æ–¯ã€é¼“â€å¯å•ç‹¬åˆ†ç¦»å‡ºæ–‡ä»¶
1. å¦‚æœç”µè„‘æ²¡æœ‰NVIDIAæ˜¾å¡æˆ–æœªé…ç½®cudaç¯å¢ƒï¼Œä¸è¦é€‰æ‹© 4stemså’Œ5stemsæ¨¡å‹ï¼Œå°¤å…¶æ˜¯å¤„ç†è¾ƒé•¿æ—¶é•¿çš„éŸ³é¢‘æ—¶, å¦åˆ™å¾ˆå¯èƒ½è€—å°½å†…å­˜



# è‡´è°¢

æœ¬é¡¹ç›®ä¸»è¦ä¾èµ–çš„å…¶ä»–é¡¹ç›®

1. https://github.com/deezer/spleeter
2. https://github.com/pallets/flask
3. https://ffmpeg.org/
4. https://layui.dev

